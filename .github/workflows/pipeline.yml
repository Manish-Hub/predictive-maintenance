name: Predictive Maintenance CI/CD

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v4

    - name: Set up Python
      uses: actions/setup-python@v5
      with:
        python-version: "3.10"

    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt

    - name: Run tests (optional)
      run: |
        echo "âœ… No tests defined yet, skipping..."
        # pytest tests/  # uncomment if you add tests

    - name: Build Docker image (validation only)
      run: |
        docker build -t predictive-maintenance-app .

    - name: Deploy to Hugging Face Spaces
      env:
        HF_TOKEN: ${{ secrets.HF_TOKEN }}
      run: |
        pip install huggingface_hub
        python - <<'EOF'
        from huggingface_hub import HfApi
        import os

        api = HfApi()
        space_id = "ManishTK44/predictive-maintenance-app"

        files = [
            "app.py",
            "requirements.txt",
            "Dockerfile",
            "README.md",
            "xgb_model_final.pkl",
            "xgb_threshold.txt",
            "scaler.pkl",
            "engine_data.csv"
        ]

        for f in files:
            if os.path.exists(f):
                api.upload_file(
                    path_or_fileobj=f,
                    path_in_repo=f,
                    repo_id=space_id,
                    repo_type="space",
                    token=os.environ["HF_TOKEN"]
                )
        EOF
